# Several of the peer-to-peer and worm-related signatures were taken 
# from Emerging Threats (http://www.emergingthreats.net/)
#
# In order to use different rulesets, please point the variable snort_rules,
# defined below (in [defaults]), to your local file(s).
#

[defaults]
priority=4
max_enable=3
actions=email,log
auto_enable=Y
disable=Y
grace=120m
button_text=Enable Network
snort_rules=local.rules,emerging-attack_response.rules,emerging-exploit.rules,emerging-p2p.rules,emerging-scan.rules,emerging-virus.rules
# vlan: The vlan parameter allows you to define in what vlan a node with a violation will be put in.
# accepted values are the vlan names: isolationVlan, normalVlan, registrationVlan, macDetectionVlan, guestVlan, 
#                                     customVlan1, customVlan2, customVlan3, customVlan4, customVlan5 
# (see switches.conf)
vlan=isolationVlan
# if you add a category here, nodes in these categories will be immune to the violation
whitelisted_categories=

[1100001]
desc=Scan
# On a Scan violation priority must be higher than the special system scan violation (1200001)
priority=10
url=/content/index.php?template=failed_scan
max_enable=4
button_text=Scan my computer again
trigger=Scan::10861,Scan::10943,Scan::11177,Scan::11231,Scan::11302,Scan::11304,Scan::11528,Scan::11595,Scan::11664,Scan::11787,Scan::11790,Scan::11803,Scan::11808,Scan::11835,Scan::11878,Scan::11886,Scan::11887,Scan::11921,Scan::12051,Scan::12052,Scan::12054,Scan::12092,Scan::12208,Scan::12209,Scan::13641,Scan::13852,Scan::14724,Scan::15460,Scan::15894,Scan::15970,Scan::16324,Scan::16326,Scan::16327,Scan::16328,Scan::16329,Scan::18020,Scan::18021,Scan::18023,Scan::18025,Scan::18027,Scan::18028,Scan::18215,Scan::18482,Scan::18483,Scan::18490,Scan::18502,Scan::18681,Scan::18682,Scan::19401,Scan::19402,Scan::19406,Scan::19408,Scan::20005,Scan::20172,Scan::20299,Scan::20368,Scan::20382,Scan::20389,Scan::20390,Scan::20904,Scan::20905,Scan::21213,Scan::21332,Scan::21685,Scan::21687,Scan::22030,Scan::22034,Scan::22183,Scan::22184,Scan::22185,Scan::22186,Scan::22187,Scan::22192,Scan::22194,Scan::22332,Scan::22449,Scan::22530,Scan::23644,Scan::23646,Scan::23647,Scan::23833,Scan::23835,Scan::23837,Scan::23838,Scan::23999,Scan::24000
actions=trap,email,log
disable=N
# for faster remediation, it is recommended to leave an offending client in the registration vlan (where it is scanned)
vlan=registrationVlan

#
# Example config to block a whole class of devices based on their MAC address
# Trigger format: The number is a decimal representation of the OUI (Vendor) portion of the MAC.
# To generate such a representation you can use perl -e "print hex('001620');"
# There is a copy of the oui.txt file in conf/ to help you match vendor name and vendor mac.
#
[1100002]
desc=Block a type of Sony Ericsson Mobile MAC addresses
url=/content/index.php?template=banned_devices
trigger=VENDORMAC::5664
actions=trap,email,log
disable=Y

#
# Example config to block an OS based on their dhcp fingerprint
# Trigger format: an id (defined as os_id in os_type table)
# Right now the only way to find the os id is to query the database but it should be feasible
# from the pfcmd tool or the web gui in the future.
# From a MySQL prompt, a 'select * from os_type;' will give you what you need. Just put in 
# the os_id next to OS::. In exemple to block Windows 95 you would use: OS::104
#
# The below example blocks Windows 95, 98, 98SE, NT4 and ME.
#
[1100003]
desc=Ban Ancient OSes
url=/content/index.php?template=banned_os
trigger=OS::104,OS::103,OS::106,OS::105,OS::102
actions=trap,email,log
disable=Y

#
# Example config to block a specific Browser User Agent
# This works in the same way as OS does.
# Trigger format: an id (defined as useragent_id in useragent_type table)
#
# NOTE: Unfortunately right now, we do not populate the database with User-Agent strings but 
# we plan to do so in future releases the same way we do with the dhcp fingerprint database.
# Stay tuned!
#
# Here is how you can populate the database yourself:
# INSERT INTO `useragent_class` (`class_id`, `description`) VALUES(1, 'iPod and iPhone Browser');
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (100, 'iPhone','.*iPhone\\ OS.*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (100, 1);
#
[1100004]
desc=Block iPhone and iPod browsers
url=/content/index.php?template=banned_devices
trigger=USERAGENT::100
actions=trap,email,log
disable=Y

#
# Example config of an hybrid violation which is very effective. Checking the OS, the 
# browser and the MAC VENDOR.
#
# As said earlier, we don't provide the user agent database yet (to come).
# Here is how you can populate the database yourself:
# INSERT INTO `useragent_class` (`class_id`, `description`) VALUES(1, 'iPod and iPhone Browser');
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (100, 'iPhon e','.*iPhone\\ OS.*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (100, 1);
# INSERT INTO `useragent_class` (`class_id`, `description`) VALUES(2, 'Android Browser');
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (200, 'Android','.*Android.*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (200, 2);
#
[1100005]
desc=Block iPhone, iPod touch and Android devices
url=/content/index.php?template=banned_devices
trigger=OS::311,OS::315,USERAGENT::100,USERAGENT::200,VENDORMAC::2349,VENDORMAC::9078 
actions=trap,email,log
vlan=registrationVlan
disable=Y


[1100006]
desc=Disable NATing Routers and APs
url=/content/index.php?template=nat
trigger=Detect::1100005,Detect::1100006,Detect::1100007,OS::4
actions=trap,email,log
disable=Y

[1100009]
desc=Darknet Access
url=/content/index.php?template=darknet
trigger=Detect::1100009
actions=email,log
disable=Y

[1100010]
desc=Rogue DHCP
url=/content/index.php?template=roguedhcp
actions=email,log
disable=N

#  1200000 - 120099 Reserved for required administration violations

[1200001]
priority=9
desc=System Scan
# someone should always be able to try to scan its system again
max_enable=0
url=/content/index.php?template=system_scan&admin=yes
actions=trap,log
button_text=Scan
disable=Y
# Scan is taking place in the registration vlan don't change this value. 
vlan=registrationVlan

[1200003]
desc=Auto-registered Device
priority=1
trigger=OS::3,OS::6,OS::7,OS::8,OS::10,OS::12,OS::13
actions=log,autoreg
disable=Y

# 1300000 - 1399999 Reserved for PacketFence violations

[1300000]
desc=Generic
priority=8
actions=trap,log
url=/content/index.php?template=generic
disable=N

[1300001]
desc=Spam
priority=6
actions=trap,log
url=/content/index.php?template=spam
disable=N

# 1400000 - 1499999 Reserved for local violations


[2000032]
desc=LSASS Exploit
priority=4
url=/content/index.php?template=lsass
redirect_url=/proxies/tools/stinger.exe
disable=N
trigger=Detect::2000032,Detect::2000033,Detect::2000046,Detect::2001286,Detect::2001337,Detect::2001302

[2002030]
desc=IRC Trojan
priority=3
auto_enable=N
url=/content/index.php?template=trojan
disable=N
trigger=Detect::2002029,Detect::2002030,Detect::2002031,Detect::2002032,Detect::2002033,Detect::2000345,Detect::2000347,Detect::2000348,Detect::2000349,Detect::2000350,Detect::2000351,Detect::2000352
actions=trap,email,log

# The following signatures replace the generic portscan detector.  It was notoriously noisy, expecially
# for BitTorrent clients.  These new signatures look for most of the "worm-like" scanning behaviors.

[2002201]
desc=Zotob (W32.Zotob and variants)
priority=4
url=/content/index.php?template=zotob
disable=N           
trigger=Detect::2002201,Detect::2002203

[2001904]
desc=Telnet Scan
priority=6
url=/content/index.php?template=scanning
disable=N
auto_enable=N
trigger=Detect::2001904

[2001972]
desc=Remote Desktop Scan
priority=6
url=/content/index.php?template=scanning
disable=N
auto_enable=N
trigger=Detect::2001972

[2001569]
desc=NetBIOS Scan
priority=6
url=/content/index.php?template=scanning
disable=N
auto_enable=N
trigger=Detect::2001569,Detect::2001579,Detect::2001580,Detect::2001581,Detect::2001582,Detect::2001583

# The following are peer-to-peer (P2P) signatures.  They can be exceedingly loud, but seem fairly accurate in our experience.
# Since P2P is not considered illicit on all networks, they are all shipped disabled - set disable=N to enable.

[2000334]
desc=P2P (BitTorrent)
priority=8
url=/content/index.php?template=p2p
disable=Y
max_enable=1
trigger=Detect::2000334,Detect::2000357,Detect::2000369

[2001808]
desc=P2P (Limewire)
priority=8
url=/content/index.php?template=p2p
disable=Y
max_enable=1
trigger=Detect::2001808

[2000330]
desc=P2P (eDonkey)
priority=8
url=/content/index.php?template=p2p
disable=Y
max_enable=1
trigger=Detect::2000330,Detect::2000331,Detect::2000332,Detect::2000333,Detect::2001296,Detect::2001297,Detect::2001298,Detect::2001299,Detect::2001305,Detect::2001300

[2001664]
desc=P2P (Gnutella)
priority=8
url=/content/index.php?template=p2p
disable=Y
max_enable=1
trigger=Detect::2001664,Detect::2002760,Detect::2002761

[2001812]
desc=P2P (Kazaa)
priority=8      
url=/content/index.php?template=p2p
disable=Y
max_enable=1
trigger=Detect::2001796,Detect::2001812

#
# SAMPLE CONFIGURATION TO BAN DEVICES 
#

# iPods / iPhones
#
# Preparing UserAgent tables:
# INSERT INTO `useragent_class` (`class_id`, `description`) VALUES(1, 'Mobile Browser');
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (100, 'iPhone','.*iPhone\\ OS.*');
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (101, 'iPod','.*iPod.*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (100, 1);
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (101, 1);
#
# to activate, uncomment below and set disable=N
#[3000000]
#desc=Block iPhone and iPod touch
#url=/content/index.php?template=banned_devices
#actions=trap,email,log
#vlan=registrationVlan
#disable=Y
#priority=10
#trigger=OS::311,USERAGENT::100,USERAGENT::101

# BlackBerries
#
# Preparing UserAgent tables:
# INSERT INTO `useragent_class` (`class_id`, `description`) VALUES (1, 'Mobile Browsers');
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (111, 'BlackBerry','.*BlackBerry.*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (111, 1);
#
# MAC vendors: 00:0f:86, 00:1c:cc, 00:21:06, 00:23:7a, 00:24:9f, 00:25:57
#
# to activate, uncomment below and set disable=N
#[3000001]
#desc=Block BlackBerries
#url=/content/index.php?template=banned_devices
#actions=trap,email,log
#vlan=registrationVlan
#disable=Y
#priority=10
#trigger=VENDORMAC::3974,VENDORMAC::7372,VENDORMAC::8454,VENDORMAC::9082,VENDORMAC::9375,VENDORMAC::9559,USERAGENT::111

# PlayStation 3 and PlayStation Portable (PSP)
#
# Preparing UserAgent tables:
# INSERT INTO `useragent_class` (`class_id`, `description`) VALUES (6, 'Gaming Device Browsers');
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (601,'Playstation 3','.*PLAYSTATION\\ 3.*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (601, 6);
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (602,'Playstation 3','.*PS3\\ \\(PlayStation\\ 3\\).*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (602, 6);
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (603,'Playstation Portable (PSP)','.*PSP\\ \\(PlayStation\\ Portable\\).*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (603, 6);
# INSERT INTO `useragent_type` (`useragent_id`, `description`, `match_expression`) VALUES (604,'Playstation Portable (PSP)','.*PSP.*PlayStation\\ Portable.*');
# INSERT INTO `useragent_mapping` (`useragent_type`, `useragent_class`) VALUES (604, 6);
#
# to activate, uncomment below and set disable=N
#[3000002]
#desc=Block PlayStation 3 and PlayStation Portable (PSP)
#url=/content/index.php?template=banned_devices
#actions=trap,email,log
#vlan=registrationVlan
#disable=Y
#priority=10
#trigger=USERAGENT::601,USERAGENT::602,USERAGENT::603,USERAGENT::604,OS::605

# Sling Box
# Media streaming device
#
# MAC vendor: 00:13:b6
#
# to activate, uncomment below and set disable=N
#[3000003]
#desc=Block Slingbox
#url=/content/index.php?template=banned_devices
#actions=trap,email,log
#vlan=registrationVlan
#disable=Y
#priority=10
#trigger=VENDORMAC::5046,OS::703
